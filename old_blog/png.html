<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- saved from url=(0085)https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/ -->
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link type="text/css" rel="stylesheet" href="./png/banner-styles.css">


				<title>Taming your PNGs | Alan Ayoub</title>
		
	<!-- Basic Meta Data -->
	<meta name="Copyright" content="Titan Theme Design: Copyright 2009 Jestro LLC">
	<meta http-equiv="imagetoolbar" content="no">
	
		
	<!-- Favicon -->
	<link rel="shortcut icon" href="https://web.archive.org/web/20101212230142im_/http://www.alanayoub.com/wp-content/themes/titan/images/favicon.ico">

	<!--Stylesheets-->
	<link href="./png/style.css" type="text/css" media="screen" rel="stylesheet">
	<!--[if lt IE 8]>
	<link rel="stylesheet" type="text/css" media="screen" href="/web/20101212230142/http://www.alanayoub.com/wp-content/themes/titan/ie/ie.css" />
	<![endif]-->
	<!--[if lte IE 6]>
	<script type="text/javascript" src="/web/20101212230142/http://www.alanayoub.com/wp-content/themes/titan/ie/nav.js"></script>
	<![endif]-->

	<!--SyntaxHighlighter-->
        <link type="text/css" rel="stylesheet" href="./png/shCore.css">
        <link type="text/css" rel="stylesheet" href="./png/shThemeDefault.css"> 
        <script type="text/javascript" src="./png/shCore.js"></script>
        <script type="text/javascript" src="./png/shBrushJScript.js"></script>
        <script type="text/javascript" src="./png/shBrushBash.js"></script>
        <script type="text/javascript" src="./png/shBrushCpp.js"></script>
        <script type="text/javascript" src="./png/shBrushXml.js"></script>
        <script type="text/javascript">
          SyntaxHighlighter.defaults['light'] = true;
          SyntaxHighlighter.defaults['smart-tabs'] = true;
          SyntaxHighlighter.defaults['toolbar'] = false;
          SyntaxHighlighter.defaults['tab-size'] = 2;
          SyntaxHighlighter.defaults['wrap-lines'] = false;
          SyntaxHighlighter.all();
        </script>

	<!--Wordpress-->
	<link rel="alternate" type="application/rss+xml" title="Alan Ayoub RSS Feed" href="http://www.alanayoub.com/feed/">
	<link rel="pingback" href="http://www.alanayoub.com/xmlrpc.php">
	<!--WP Hook-->
  	<link rel="alternate" type="application/rss+xml" title="Alan Ayoub » Taming your PNGs Comments Feed" href="http://www.alanayoub.com/taming-your-pngs/feed/">
<link rel="stylesheet" id="syntaxhighlighter-core-css" href="./png/shCore(1).css" type="text/css" media="all">
<link rel="stylesheet" id="syntaxhighlighter-theme-default-css" href="./png/shThemeDefault(1).css" type="text/css" media="all">
<script type="text/javascript" src="./png/jquery.js"></script>
<script type="text/javascript" src="./png/comment-reply.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.alanayoub.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.alanayoub.com/wp-includes/wlwmanifest.xml"> 
<link rel="index" title="Alan Ayoub" href="http://www.alanayoub.com/">
<link rel="start" title="Modular CSS" href="http://www.alanayoub.com/modular-css/">
<link rel="prev" title="Old 3D artwork" href="http://www.alanayoub.com/my-old-3d-graphics-artwork/">
<link rel="next" title="CSS History Hack" href="http://www.alanayoub.com/css-history-hack/">
<meta name="generator" content="WordPress 2.8.4">
<link rel="stylesheet" href="./png/stylesheet.css" type="text/css"><meta name="description" content="An in depth article on PNGs. This goes beyond PNG8 and shows you how to get around those nasty bugs and the lack of support for many of PNGs features.">
<style>@-webkit-keyframes popwsiyvfwlrpmvtjlmxulkgldiefscdkowsifr {50% {-webkit-transform:scale(1.2);}100% {-webkit-transform:scale(1);}}@keyframes popwsiyvfwlrpmvtjlmxulkgldiefscdkowsifr {50% {-webkit-transform:scale(1.2);transform:scale(1.2);}100% {-webkit-transform:scale(1);transform:scale(1);}}#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr-blocked{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;color:#AAA !important;display:inline !important;text-decoration:line-through !important;}#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr br{display:block !important;padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;}#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr span{background:transparent !important;padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;}#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr div{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr a{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}a#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr-gear{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;text-decoration:none !important;position:absolute !important;display:none !important;font-size:20px !important;width:20px !important;height:20px !important;line-height:20px !important;text-align:center !important;background-color:rgba(255,255,255,.8) !important;background-image:url(chrome-extension://mlomiejdfkolichcflejclcbmpeaniij/data/images/gear.svg) !important;background-size:16px 16px !important;background-position:center center !important;background-repeat:no-repeat !important;text-decoration:none !important;}a#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr-gear:hover{-webkit-animation-name:popwsiyvfwlrpmvtjlmxulkgldiefscdkowsifr !important;animation-name:popwsiyvfwlrpmvtjlmxulkgldiefscdkowsifr !important;-webkit-animation-duration:0.3s !important;animation-duration:0.3s !important;}#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr:hover #wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr-gear{text-decoration:none !important;display:inline-block !important;}@media print{#wsiyvfwlrpmvtjlmxulkgldiefscdkowsifr{display:none !important;}}</style></head>
<body>
<div class="content-background">
<div class="wrapper">
	<div class="notice">
		 
	  	 </div><!--end notice-->
	<div id="content">     						<div class="post single" id="post-7">
			<div class="post-header">
				<div class="tags"><span>Tags</span> <p><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/tag/alpha-transparency/" rel="tag">Alpha Transparency</a>, <a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/tag/graphics/" rel="tag">Graphics</a>, <a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/tag/images/" rel="tag">Images</a>, <a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/tag/png/" rel="tag">PNG</a></p></div>
				<h1>Taming your PNGs</h1>
        <div class="author">by Alan Ayoub on September 4th, 2009</div>
      </div><!--end post header-->		
			<div class="entry clear">
				<p><img class="alignnone size-full wp-image-255" title="Taming Your PNGs" src="./png/taming_your_pngs.png" alt="Taming Your PNGs"></p>
<p>The PNG format was created to improve upon the GIF, and it does in all aspects except maybe animation. So why do so many people still use GIF? While PNGs offer much higher quality graphics, a better feature set and more control regarding compression, if not harnessed correctly you may get smaller file sizes with a GIF, you may also run into PNG compatibility problems with some browsers. In this article I’m going explain some of the benefits of using PNGs and let you in on a few little known techniques to get the most out of them.</p>
<p><span id="more-7"></span></p>
<p>OK so PNG and GIF are really quite different. PNGs have 5 different pixel types to choose from.</p>
<ul>
<li>True colour with aplha</li>
<li>Greyscale with alpha</li>
<li>Truecolour</li>
<li>Greyscale</li>
<li>Indexed-colour</li>
</ul>
<p>GIFs only come in indexed-colour.</p>
<h2>Alpha channel transparency</h2>
<p>PNG supports RGBA (true colour with alpha). Each pixel can be assigned a transparent value. For example R:0 G:0 B:0 A:127 would be black at 50% opacity. GIFs only support binary transparency where a pixel is either fully opaque or fully transparent. All you have to do is “save as” png from Photoshop or “save as” Flattened PNG from Fireworks.</p>
<p><img class="alignnone size-full wp-image-210" title="alpha_channel_transparency_you_cant_do_this_with_a_gif" src="./png/alpha_channel_transparency_you_cant_do_this_with_a_gif.jpg" alt="alpha_channel_transparency_you_cant_do_this_with_a_gif"></p>
<p><strong>PLEASE NOTE:</strong> The names of some of these image types can be a little confusing. While the specification says:</p>
<blockquote><p>For PNG image types other than indexed-colour, the bit depth specifies the number of bits per sample, not the total number of bits per pixel.</p></blockquote>
<p>and thats fine, however most software and users generally talk about the total number of bits per pixel. To confuse things further Photoshop calls RGBA PNGs 24 bit while Fireworks calls them 32 bit!</p>
<h2>Internet Explorer 6</h2>
<p>Unfortunately these days not many articles get by without the a section on how IE doesn’t play ball. This one is no different.</p>
<p><strong>IE6 does not support the alpha-channel information in PNGs</strong>. While there are some ways to force it to work, I don’t recommend you use any of them.</p>
<p><img class="size-full wp-image-212 alignnone" title="ie6_doesnt_support_32-bit_pngs" src="./png/ie6_doesnt_support_32-bit_pngs.jpg" alt="IE6 doesnt support 32-bit pngs :("></p>
<h3>IE Filters</h3>
<p><a title="Visual Filters and Transitions Reference" href="https://web.archive.org/web/20101212230142/http://msdn.microsoft.com/en-us/library/ms532853%28VS.85%29.aspx" target="_blank">IE filters</a> have been around for a long time and allow you to create effects like transparency, shadows and gradients amongst other things. The problem, besides this being a non standard technique is that behind the scenes <strong>Internet Explorer uses DirectX to achieve these effects</strong>.</p>
<pre>filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="shadow.png", sizingMethod="crop");</pre>
<ul>
<li>Filters use DirectX and will slow down the rendering of your page</li>
<li>The AlphaImageLoader filter blocks rendering and freezes the browser while the image is being downloaded</li>
<li>Filters increase memory consumption</li>
<li>AlphaImageLoader is applied per element, not per image</li>
<li>The AlphaImageLoader filter doesn’t support all the CSS properties</li>
<li>Some corporations disable DirectX for security reasons</li>
<li>Filters are a non standard technique</li>
</ul>
<p>These other solutions described below are all variants that use the AlphaImageLoader filter in one way or another, JavaScript, Flash, PHP etc.</p>
<h3>HTC behaviour files</h3>
<p>These DHTML Behaviors (introduced in IE5.5) in the form of HTML Component (HTC) files simply use JavaScript to augment IE6 by mimicking some of the browsers missing functionality.</p>
<p>This may sound great, however it’s a well known fact that IE6s JavaScript rendering is uber slow. In this case all <a title="A JavaScript behaviour file that adds support for 32bit PNGs in IE6" href="https://web.archive.org/web/20101212230142/http://webfx.eae.net/dhtml/pngbehavior/pngbehavior.html" target="_blank">pngbehavior.htc</a> does is use JavaScript to automate the use of IE filters. So you are still using DirectX. Also, with the dependency moderns sites have on JavaScript I don’t see any good reason to slow down rendering further with transparency hacks like this.</p>
<h3>Flash</h3>
<p>This Flash solution (<a title="Pngpong - A flash solution to display transparent PNGs in IE6" href="https://web.archive.org/web/20101212230142/http://blog.psyrendust.com/pngpong/" target="_blank">Pngpong</a>) uses Flash Player and JavaScript (SWFObject) to display transparent PNGs in IE6. Flash + JavaScript just to display 32-bit PNGs in IE6… no thanks, I’d rather degrade to a gif.</p>
<h3>PHP</h3>
<p>There are also many server side solutions out there, <a title="A php solution to display transparent PNGs in IE6" href="https://web.archive.org/web/20101212230142/http://koivi.com/ie-png-transparency/" target="_blank">this one uses PHP</a> and does pretty much the same thing as the HTC file but on the serverside.</p>
<h3>Degrade for IE6 using Conditionals</h3>
<p>To avoid using the resource hungry techniques described above, some people resort to serving a separate GIF for IE6 using conditionals. Read on to find out a better technique where we will use the same image for all browsers and no hacks.</p>
<h2>IE7 and possibly IE8</h2>
<p>While IE7+ has native support for PNG32 there is at least one problem with the implementation. When using opacity with variable transparency the transparent pixels turn black before the opacity is applied. While this definatly does suck, its a bit of an edge case.</p>
<p><img class="alignnone size-full wp-image-224" title="IE7 Alpha Transparency and Opacity" src="./png/ie7_alpha_transparency_opacity.jpg" alt="IE7 Alpha Transparency and Opacity"></p>
<h2>8-bit PNG with Alpha transparency</h2>
<p>A little known fact about PNGs is that Alpha Transparency is not limited to 32-bit versions. Support for 8-bit PNGs with Alpha Transparency in most graphics packages is either nonexistent or flaky, however it is possible, and the benefits are glorious.</p>
<p>Here are the two main reasons why this is a good thing:</p>
<ul>
<li>8-bit PNGs are smaller than the 32-bit versions</li>
<li>8-bit PNGs with alpha transparency degrade gracefully in IE6</li>
</ul>
<p>As described earlier, if you display a 32 bit PNG in IE6, IE will apply an opaque bluey grey background color to the image. With our 8-bit version any semi transparent pixels in the image will simply disappear!</p>
<p><img class="alignnone size-full wp-image-238" title="8-bit png IE6" src="./png/8-bit_png_IE6.jpg" alt="8-bit png IE6"></p>
<p>Before explaining how to do this lets take some time to discuss the 8-bit PNG format. It is actually the indexed-colour PNG from the list we had previously. It can also be called palette colour as it uses a colour palette.</p>
<ul>
<li><span style="color: #888888;">True colour with aplha</span></li>
<li><span style="color: #888888;">Greyscale with alpha</span></li>
<li><span style="color: #888888;">Truecolour</span></li>
<li><span style="color: #888888;">Greyscale</span></li>
<li><strong>Indexed-colour (palette colour)<br>
</strong></li>
</ul>
<p>For indexed-colour images, the bit depth specifies the number of bits in each palette index, not the sample depth of the colours in the palette or alpha table.</p>
<h3>Indexed-colour</h3>
<p><img class="alignnone size-full wp-image-240" title="How index colour images work" src="./png/how_index_colour_images_work.jpg" alt="How index colour images work"></p>
<p>In the illustration above you can see that each pixle in the graphic gets assigned an index number, and that number relates to a colour in the palette. This is an 8 bit system therefor the index and palette are limited to a maximum of 256 values. However the colours in the palette can be 24 or 32 bit depending on if the optional  alpha table is included.</p>
<h3>How to create 8-bit PNGs with Alpha Transparency</h3>
<p>Unfortunately Photoshop does not support variable transparency with the PNG8 format so i am going to use fireworks for this example. However you can download the <a href="https://web.archive.org/web/20101212230142/http://www.ardfry.com/png-plugin/" target="_blank">pngout plugin for Photoshop</a> that will allow you to do the same.</p>
<p>This first screen shot below shows the image preview dialogue from Fireworks, you can see that the image format is set to PNG8 but the transparency is set to index. This way you can only have one fully transparent pixel, just like a GIF.</p>
<p><img class="alignnone size-full wp-image-265" title="8-bit indexed fireworks screenshot" src="./png/8-bit_indexed_Fireworks_screenshot.jpg" alt="8-bit indexed fireworks screenshot"></p>
<p>In the next screenshot I have changed the transparency to Alpha Transparency, now in the image preview you can see straight through the graphic to the cavas behind. Also, have a look at the palette, there is a new colour chip type, the ones with the corner taken out of them are the semi transparent colours. The leftmost colour in the palette is still the fully transparent pixel as per above.</p>
<p><img class="alignnone size-full wp-image-266" title="8-bit alpha fireworks screenshot" src="./png/8-bit_alpha_Fireworks_screenshot.jpg" alt="8-bit alpha fireworks screenshot"></p>
<p>As i mentioned at the start of this article, support is still rarther flaky for the more advanced PNG options. If you look closely at the image you can see some banding, you may also have noticed that there are only 7 colours in the alpha transparent verison. A bug in Fireworks resets the palette to Adaptive whenever you select Alpha Transparency. This is only really a problem when you are using lots of pixels which are very similar, for example a gradient of the same colour. Dithering helps a bit but ends up unnecessarily increasing the filesize. If you really need to create a perfect quality gradient you can take a more manual approach.</p>
<h3>Manually adding transparency to colours in the palette</h3>
<p>To do this save out the graphic with the options from the first screenshot, index transparency and palette type exact (Fireworks users: don’t forget to save as a flattened PNG). Then go download <a title="TweakPNG is a low-level utility for examining and modifying PNG image files" href="https://web.archive.org/web/20101212230142/http://entropymine.com/jason/tweakpng/" target="_blank">tweakPNG</a>.</p>
<p>When you open the graphic with tweakPNG you should see something like the following:</p>
<p><img class="alignnone size-full wp-image-275" title="TweakPNG" src="./png/tweakPNG_default.jpg" alt="TweakPNG"></p>
<p>What you are seeing here is the PNG chunk data, don’t worry too much about that for now, we will talk about it in more detail later on. For now all we are interested in is the tRNS chunk. This controls the alpha table.</p>
<p>Double clicking on the tRNS chunk will open the images colour palette and allow you to edit the transparency information.</p>
<p><img class="alignnone size-full wp-image-278" title="TweakPNG tRNS chunk" src="./png/tweakPNG_tRNS_chunk.jpg" alt="TweakPNG tRNS chunk"></p>
<p>As you see there are 103 colours in the palette so this may take some time! However you can save out the data and use it on other images if you need to.</p>
<p>Depending on the level of transparency you are looking for you may need to do some math. For this example we want about 50% transparency. Having 103 shades in our palette we can pretty much start the most opaque colour at alpha 102 and work down to alpha 0, full transparency.</p>
<p><img class="alignnone size-full wp-image-283" title="TweakPNG tRNS edit" src="./png/tweakPNG_tRNS_edit.jpg" alt="TweakPNG tRNS edit"></p>
<h3>Here is the result:</h3>
<p><img class="alignleft size-full wp-image-292" style="margin: 0pt 5px 0pt 0pt;" title="png8 exact manual transparency" src="./png/shaddow_png_8_exact_manual_transparency.jpg" alt="png8 exact manual transparency" width="327" height="120">This image works on any background, it degrades in IE6 and we have solved the banding issue. Next lets look at compression.</p>
<h2>Compression</h2>
<p>The original 32 bit image started off at 6kb. While this 8bit one is only 4k there is still lots more we can do. One obvious thing we should have done before editing the transparency is to reduce the number of colours.</p>
<p>In order to prevent banding we set the palette to “exact”, that gave us 103 colours. Lets reduce this number and look at some other compression techniques.</p>
<p>First open the graphic in Fireworks and select 2-Up mode</p>
<p><img class="size-full wp-image-301 alignnone" title="Fireworks 2up" src="./png/shaddow_2_up.jpg" alt="Fireworks 2up" width="488" height="266"></p>
<p>Go to the optimize panel and remove colours until you are happy with the balance between filesize and quality. Changing the sort between luminance and popularity helps you select colours that will have the least amount of visual impact when removed. You should be looking for the least popular colours that are similar to other colours in the palette.</p>
<p><img class="alignnone size-full wp-image-307" title="Firefox colour palette manipulation 1" src="./png/shaddow_delete_colours_1.jpg" alt="Firefox colour palette manipulation step 1"></p>
<p>Not wanting to delete too many similar colours i unselected a few before deleting the rest. I repeated this procedure until i had a good balance.</p>
<p><img class="alignnone size-full wp-image-308" title="Firefox colour palette manipulation step 2" src="./png/shaddow_delete_colours_2.jpg" alt="Firefox colour palette manipulation step 2"></p>
<p>Now save out as as flattened png and create the tRNS chunk again using TweakPNG. We are now back at the stage we where before but we have reduced the image by a further 2k.</p>
<p>The final piece of compression we are going to look at is to remove any unnecessary PNG chunks.</p>
<h3>Chunks</h3>
<p>There are 18 chunk types defined in the PNG Specification, 4 of them a critical chunks.</p>
<ul>
<li><strong>IHDR</strong>: PNG image header</li>
<li><strong>PLTE</strong>: palette table, only for indexed PNGs</li>
<li><strong>IDAT</strong>: PNG image data</li>
<li><strong>IEND</strong>: end of image marker</li>
</ul>
<p>You can identifiy the critical chunks easily as they are all in full caps.</p>
<p>There are 14 other optional chunk types:</p>
<ul>
<li><strong>tRNS</strong>: Transparency information</li>
<li><strong>cHRM</strong>, <strong>gAMA</strong>, <strong>iCCP</strong>, <strong>sBIT</strong>, <strong>sRGB</strong>: Colour space information</li>
<li><strong>iTXt</strong>, <strong>tEXt</strong>, <strong>zTXt</strong>: Textual information</li>
<li><strong>bKGD</strong>, <strong>hIST</strong>, <strong>pHYs</strong>, <strong>sPLT</strong>: Miscellaneous information</li>
<li><strong>tIME</strong>: Time information</li>
</ul>
<p>By removing all but the critial and transparency chunks we can further compress our image.</p>
<p>Lucky for us there are very easy ways to do this. We can either use TweakPNG to manually choose what chunks we want to remove, or you can download <a title="PNGOUT - tool for compression PNGs" href="https://web.archive.org/web/20101212230142/http://www.ardfry.com/pngoutwin/" target="_blank">PNGOUT</a> and have it batch crush multiple PNGs at once.</p>
<p>I have found PNGOUT to be the best compression tool for PNGs. It comes as either a free command line utility or with a GUI for ~$14. Just drag and drop as many PNGs as you like into the UI and it will automatically compress them.</p>
<p>Dragging our image into PNGOUT and it removes all ancillary chunks except for the tRNS chunk.</p>
<p>This saves us a further 300 bytes.</p>
<p><img class="alignnone size-full wp-image-319" title="PNGOUT Screenshot" src="./png/PNGOUT.jpg" alt="PNGOUT Screenshot"></p>
<h2>The Results</h2>
<p>Our image that started out as a 6kb 32bit png that didnt work in IE6 is now an 8bit graphic at 1.5kb that degrades gracefully in IE6.</p>
<p>6kb 32bit PNG</p>
<p><img class="size-full wp-image-323 alignnone" title="32bit at 7kb" src="./png/shaddow_photoshop_png_32.jpg" alt="shaddow photoshop png 32" width="327" height="120"></p>
<p>1.5k 8bit PNG</p>
<p><img class="alignnone size-full wp-image-324" title="8bit at 1.5k" src="./png/shaddow_fireworks_png_8_reduced_palette_to_26_px - tweak _ pngout.png" alt="8bit at 1.5k"></p>
<h3>Google</h3>
<p>I thought id take a look at googles actual image for the infobox and see if I could compress it further.</p>
<p><a title="The sprite that google use for their map infoboxes" href="https://web.archive.org/web/20101212230142/http://maps.gstatic.com/intl/en_ALL/mapfiles/iws3.png" target="_blank">Googles original file</a> is 8,071 bytes (<a title="Googles sprite saved incase the image changes" href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/wp-content/uploads/articles/taming_your_pngs/iws3.png" target="_blank">here is a saved copy</a>). I managed to get it down to <a title="The same image after i have compressed it" href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/wp-content/uploads/articles/taming_your_pngs/iws3_after.png" target="_blank">3,966 bytes</a>, a saving of over 50%, not bad.</p>
<h2>Automaticaly converting 32bit pngs to 8bit</h2>
<p>There is a quicker way of making 8bit pngs, and this way doesnt introduce banding. However you dont get fine control over the colours in the palette.</p>
<p>Create a 32bit png in photoshop (photoshop call them 24bit), and then convert it to an 8bit png with pngquant. Run command prompt and type “pngquant 256 filename.png” in the pngquant folder. The results are pretty good. Open the png with tweakPNG to investigate the tRNS chunk. Depending on your graphic, but you will have up to 256 colours in the pallet. With Fireworks we noticed that it sometimes reduced the number of colours in the palette creating an unwanted banding effect. In this case however we may not want this many colours and thus has an effect on filesize.</p>
<p>Asking pngquant to create the image with less colours would help but doesnt give you much control and could bring back the banding issue. One thing you  could do is reduce the colours before running pngquant by posterizing the image slightly in photoshop first. At least this way we can see what we are doing instead of simply telling pngquant how many colours you want in the pallet.</p>
<h2>More on Chunks</h2>
<p>I was going to leave the article there, but i though it would be useful to talk about a couple of the other chunks. There are two others that i use quite often. The bKGD and gAMA chunks.</p>
<h3>gAMA</h3>
<p>Different platforms use different default gama settings. This means that if you create an image on a PC it will look brighter on a Mac, and images created on a Mac will look darker on a PC.</p>
<p>The problem is that your browser has no idea what gama setting your image was originally displayed at, and thus has no way of compensating for the differences between platforms.</p>
<p>The PNG gAMA chunk stores this information when the image is created. That way it can display the image perfectly on every platform.</p>
<p>Depending on your needs you may want to remove the gAMA chunk altogether. Take the following situation for example. If you create a PNG with a gAMA chunk, the image will look the same on both PC and MAC platforms, however if you have a CSS background of the same colour behind the image, the colours will look different. This is because the image is being corrected but the CSS colour isnt.</p>
<p><img class="alignnone size-full wp-image-353" title="gAMA difference" src="./png/gAMA_difference.jpg" alt="gAMA difference" width="494" height="265"></p>
<p>This is just an example, in this particular case you could of course just make the background of the image transparent.</p>
<h3>bKGD</h3>
<p>The bKGD chunk can be useful for changing the default fall back colour for 32 bit pngs. As mentioned earlier in this article, IE6 does not support 32 bit pngs and will automatically apply a  bluey grey background colour to the graphics. Using the bKGD chunk you can change that background to any colour. This can be useful if you want a transparent background on an image that requires more than 256 colours. You can choose a background colour for the transparency to degrade to on E6.</p>
<h2>End</h2>
<p>I know the png8 format is fairly well known at this stage, what I wanted to do in this article is expand upon it, and explain some solutions to the bugs I have come up against over the years. I also wanted to share some learnings I have found from trying out various techniques and tools.</p>
<p>This is obviously a very large area to cover and so I’m already considering a part two to this article, that depends of course on how this one is received.</p>
        				                                <div style="text-align:right"><a href="https://web.archive.org/web/20101212230142/http://del.icio.us/submit?url=http%3A%2F%2Fwww.alanayoub.com%2Ftaming-your-pngs%2F&title=Taming+your+PNGs" target="_blank"><img src="./png/del.png" width="32px" height="32px" alt="Delicious" title="Delicious"></a><a href="https://web.archive.org/web/20101212230142/http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.alanayoub.com%2Ftaming-your-pngs%2F&t=Taming+your+PNGs" target="_blank"><img src="./Taming your PNGs   Alan Ayoub_files/facebook.png" width="32px" height="32px" alt="Facebook" title="Facebook"></a><a href="https://web.archive.org/web/20101212230142/http://digg.com/submit?phase=2&url=http%3A%2F%2Fwww.alanayoub.com%2Ftaming-your-pngs%2F" target="_blank"><img src="./Taming your PNGs   Alan Ayoub_files/digg.png" width="32px" height="32px" alt="Digg" title="Digg"></a><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/feed/" target="_blank"><img src="./Taming your PNGs   Alan Ayoub_files/rss.png" width="32px" height="32px" alt="RSS Feed" title="RSS Feed"></a><a href="https://web.archive.org/web/20101212230142/http://www.stumbleupon.com/submit?url=http%3A%2F%2Fwww.alanayoub.com%2Ftaming-your-pngs%2F&title=Taming+your+PNGs" target="_blank"><img src="./Taming your PNGs   Alan Ayoub_files/stumble.png" width="32px" height="32px" alt="StumbleUpon" title="StumbleUpon"></a></div>
			</div><!--end entry-->       
      <div class="meta clear">
        <p>From <a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/graphics/" title="View all posts in Graphics" rel="category tag">Graphics</a>,  <a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/optimization/" title="View all posts in Optimization" rel="category tag">Optimization</a> </p>
      </div><!--end meta-->    
		</div><!--end post-->
				<!-- You can start editing here. -->
<div id="comments">
  <div class="comment-number">
    <span>5 Comments</span>
    <a id="leavecomment" href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/#respond" title="Leave One"> →</a>
  </div><!--end comment-number-->
  <ol class="commentlist">
          <li class="comment even thread-even depth-1" id="comment-345">
      <div class="c-grav"><img alt="" src="./png/7f0b976da830de674ca57fdd8d51e3bd" class="avatar avatar-40 photo" height="40" width="40"></div>
  			<div class="c-body">
          <div class="c-head">
            Alex Simon <span class="c-permalink"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/#comment-345">permalink</a></span>   
          </div>
            				<p>Great article! Thanks for taking the time. Programmers have asked me to convert our IU from 32Bit PNGs to 8bit PNGs so that they can change palette in realtime.<br>
Can I ask a question? – Does using the PNGOUT plugin for Photoshop avoid the Fireworks banding?<br>
I have 300 graphics to change and many are gradients of similar colours. The extra steps in tweakPNG seem like it would take too long.<br>
Thanks!</p>
                    <div class="reply">
                      </div>
  				        </div><!--end c-body-->
</li>
      <li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-346">
      <div class="c-grav"><img alt="" src="./png/2b45a279497a9265dbe569373de23844" class="avatar avatar-40 photo" height="40" width="40"></div>
  			<div class="c-body">
          <div class="c-head">
            Alan Ayoub <span class="c-permalink"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/#comment-346">permalink</a></span>   
          </div>
            				<p>Hi Alex, unfortunately it doesn’t <img src="./png/icon_sad.gif" alt=":(" class="wp-smiley"> . The only tool I have used that doesn’t automatically remove colours is pngquant. It supports batch processing too so would be great for your purposes! Someone has built a GUI for it too.</p>
<p><a href="https://web.archive.org/web/20101212230142/http://www.libpng.org/pub/png/apps/pngquant.html" rel="nofollow">http://www.libpng.org/pub/png/apps/pngquant.html</a><br>
<a href="https://web.archive.org/web/20101212230142/http://jedisthlm.com/2006/03/16/manfred-a-pngquant-gui/" rel="nofollow">http://jedisthlm.com/2006/03/16/manfred-a-pngquant-gui/</a></p>
                    <div class="reply">
                      </div>
  				        </div><!--end c-body-->
</li>
      <li class="comment even thread-even depth-1" id="comment-347">
      <div class="c-grav"><img alt="" src="./png/7f0b976da830de674ca57fdd8d51e3bd" class="avatar avatar-40 photo" height="40" width="40"></div>
  			<div class="c-body">
          <div class="c-head">
            Alex Simon <span class="c-permalink"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/#comment-347">permalink</a></span>   
          </div>
            				<p>Thanks for that – I was already looking into it. I can’t seem to find out whether you can select ‘no dithering’ in it though. I’m creating a GUI for consumer electronics and we make everything out of thin slices. Dithering usually looks becomes banding when slices are stretched.</p>
<p>Thanks again!<br>
Alex</p>
                    <div class="reply">
                      </div>
  				        </div><!--end c-body-->
</li>
      <li class="comment odd alt thread-odd thread-alt depth-1" id="comment-348">
      <div class="c-grav"><img alt="" src="./png/7f0b976da830de674ca57fdd8d51e3bd" class="avatar avatar-40 photo" height="40" width="40"></div>
  			<div class="c-body">
          <div class="c-head">
            Alex Simon <span class="c-permalink"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/#comment-348">permalink</a></span>   
          </div>
            				<p>Sorry to clutter your article <img src="./png/icon_smile.gif" alt=":)" class="wp-smiley"><br>
I’ve just done a couple of tests and using the default command line text (pngquant 256 *.png) I can’t see any dithering – certainly nothing like the dithering that fireworks would normally apply. I’ll use this and then suply all the PNGs to the programmers for testing.<br>
The resultant filesize isn’t any smaller than a 32bit PNG (compressed using PngOptimizer), but it may help the programmers change palettes in realtime.</p>
<p>Thanks for your help.</p>
                    <div class="reply">
                      </div>
  				        </div><!--end c-body-->
</li>
      <li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-349">
      <div class="c-grav"><img alt="" src="./png/2b45a279497a9265dbe569373de23844" class="avatar avatar-40 photo" height="40" width="40"></div>
  			<div class="c-body">
          <div class="c-head">
            Alan Ayoub <span class="c-permalink"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/#comment-349">permalink</a></span>   
          </div>
            				<p>Hi Alex, I’m glad you found a good solution, I’ll just add you last comments in here as others may find it useful.</p>
<blockquote><p>
Hi Alan.<br>
Sorry for the posts on your article. You can delete them if you like!<br>
Just as an update, I found improved pngquant here: <a href="https://web.archive.org/web/20101212230142/http://pornel.net/pngquant" rel="nofollow">http://pornel.net/pngquant</a><br>
It seems to be very good. Producing very clean UI elements and includes batch files so all I have to do is drag the files onto the batch files and it does the rest. The “256 Median” versions seem excellent for my purposes. The other options changed the colours from the original.<br>
Thanks! Alex
</p></blockquote>
                    <div class="reply">
                      </div>
  				        </div><!--end c-body-->
</li>
  </ol>
	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
   </div><!--end comments-->

  
  <div id="respond">
    <div class="cancel-comment-reply">
      <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/taming-your-pngs/#respond" style="display:none;">Click here to cancel reply.</a></small>
    </div>
  </div><!--end respond-->


			</div><!--end content-->
  	<div id="sidebar">
  	      
  	<ul>
  		<li id="search-2" class="widget widget_search"><form method="get" id="search_form" action="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/">
	<div>
    <input type="text" name="s" id="s" class="search">
    <input type="submit" id="searchsubmit" value="Search">
  </div>
</form>
</li><li id="categories-423861931" class="widget widget_categories"><h2 class="widgettitle">Topics</h2>		<ul>
	<li class="cat-item cat-item-11"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/graphics/3d/" title="View all posts filed under 3D">3D</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/css/" title="View all posts filed under CSS">CSS</a>
</li>
	<li class="cat-item cat-item-6"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/graphics/" title="View all posts filed under Graphics">Graphics</a>
</li>
	<li class="cat-item cat-item-13"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/hacks/" title="View all posts filed under Hacks">Hacks</a>
</li>
	<li class="cat-item cat-item-7"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/optimization/" title="View all posts filed under Optimization">Optimization</a>
</li>
	<li class="cat-item cat-item-12"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/security/" title="View all posts filed under Security">Security</a>
</li>
	<li class="cat-item cat-item-14"><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/topics/tools/" title="View all posts filed under Tools">Tools</a>
</li>
		</ul>
</li>  	</ul>
	</div><!--end sidebar--></div><!--end wrapper-->
</div><!--end content-background-->
<div id="footer">
	<div class="wrapper clear">
		<div id="footer-about" class="footer-column">
			<h2>About</h2>
													Hello and thanks for visiting my blog. My name is Alan Ayoub, I have been working for Expedia Inc. on the Hotels.com user experiance team since 2005. More specifically I am the head of the UI Engineering team for Hotels.com 70+ global sites. I have been involved in website and new media design and development for over 10 years now. In past jobs I have worked as a 3D artist, web developer and graphic designer. I also have a strong interest in SEO, online marketing and affiliate.						</div>
		<div id="footer-flickr" class="footer-column">
										<ul>
		  		<li id="archives-2" class="widget widget_archive"><h2 class="widgettitle">Archives</h2>		<ul>
			<li><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/2010/07/" title="July 2010">July 2010</a></li>
	<li><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/2009/10/" title="October 2009">October 2009</a></li>
	<li><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/2009/09/" title="September 2009">September 2009</a></li>
	<li><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/2009/08/" title="August 2009">August 2009</a></li>
	<li><a href="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/2009/07/" title="July 2009">July 2009</a></li>
		</ul>
</li>		  	</ul>
					</div>
		<div id="footer-search" class="footer-column">
			<h2>Search</h2>
			 <form method="get" id="search_form" action="https://web.archive.org/web/20101212230142/http://www.alanayoub.com/">
	<div>
    <input type="text" name="s" id="s" class="search">
    <input type="submit" id="searchsubmit" value="Search">
  </div>
</form>
		</div>
		<div id="copyright">
			    <p class="copyright-notice">Copyright © 2010 alan ayoub. <a href="https://web.archive.org/web/20101212230142/http://themes.jestro.com/titan/">Titan Theme</a> by <a href="https://web.archive.org/web/20101212230142/http://www.jestro.com/">Jestro</a>.</p>
	
		</div><!--end copyright-->
	</div><!--end wrapper-->
</div><!--end footer-->

<script type="text/javascript" src="./png/jquery.form.js"></script>
<script type="text/javascript" src="./png/contact-form-7.js"></script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "/web/20101212230142/https://ssl." : "/web/20101212230142/http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./png/ga.js" type="text/javascript"></script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-640029-3");
pageTracker._trackPageview();
} catch(err) {}
</script>
		

	




<!--
     FILE ARCHIVED ON 23:01:42 Dec 12, 2010 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:12:59 Aug 9, 2015.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
</body></html>
